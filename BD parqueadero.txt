DROP TABLE IF EXISTS INVOICES;
DROP TABLE IF EXISTS PAYMENTS;
DROP TABLE IF EXISTS ENTRIES;
DROP TABLE IF EXISTS VEHICLES;
DROP TABLE IF EXISTS CLIENTS;
DROP TABLE IF EXISTS PARKINGS;
DROP TABLE IF EXISTS RATES;
DROP TABLE IF EXISTS USERS;

CREATE TABLE PARKING.USERS (
    user_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique user identifier",
    name VARCHAR(50) NOT NULL COMMENT "User name",
    email VARCHAR(100) NOT NULL UNIQUE COMMENT "User email",
    phone VARCHAR(15) NOT NULL COMMENT "User phone number",
    password VARCHAR(255) NOT NULL COMMENT "User password",
    is_superuser BOOLEAN DEFAULT FALSE COMMENT "Indicates if the user is a superuser (1 = True, 0 = False)",
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Record creation date",
    PRIMARY KEY (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE PARKING.CLIENTS (
    client_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique client identifier",
    name VARCHAR(50) NOT NULL COMMENT "Client name",
    email VARCHAR(100) NOT NULL UNIQUE COMMENT "Client email",
    phone VARCHAR(15) NOT NULL COMMENT "Client phone number",
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Record creation date",
    PRIMARY KEY (client_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE PARKING.VEHICLES (
    vehicle_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique vehicle identifier",
    client_id INT(11) NULL COMMENT "FK - Vehicle owner (client)",
    plate VARCHAR(10) NOT NULL UNIQUE COMMENT "Vehicle license plate",
    brand VARCHAR(50) NOT NULL COMMENT "Vehicle brand",
    model VARCHAR(50) NOT NULL COMMENT "Vehicle model",
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Record creation date",
    PRIMARY KEY (vehicle_id),
    FOREIGN KEY (client_id) REFERENCES CLIENTS(client_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE PARKING.PARKINGS (
    parking_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique parking identifier",
    total_spaces INT(11) NOT NULL COMMENT "Total number of spaces",
    available_spaces INT(11) NOT NULL COMMENT "Available spaces",
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Record creation date",
    PRIMARY KEY (parking_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE PARKING.RATES (
    rate_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique rate identifier",
    type ENUM('regular', 'special') NOT NULL COMMENT "Rate type (Regular = Weekdays, Special = Weekends and Holidays)",
    hourly_rate DECIMAL(10,2) NOT NULL COMMENT "Rate per hour",
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Record creation date",
    PRIMARY KEY (rate_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE PARKING.ENTRIES (
    entry_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique entry record identifier",
    vehicle_id INT(11) NOT NULL COMMENT "FK - Vehicle entering",
    user_id INT(11) NOT NULL COMMENT "FK - User registering the entry",
    parking_id INT(11) NOT NULL COMMENT "FK - Parking where vehicle enters",
    rate_id INT(11) NOT NULL COMMENT "FK - Applied rate",
    entry_date DATETIME NOT NULL COMMENT "Entry date and time",
    exit_date DATETIME NULL COMMENT "Exit date and time",
    total_time INT(11) NULL COMMENT "Total time in minutes",
    total_amount DECIMAL(10,2) NULL COMMENT "Total amount to pay",
    status ENUM('in_progress', 'finished') NOT NULL DEFAULT 'in_progress' COMMENT "Entry status",
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Record creation date",
    PRIMARY KEY (entry_id),
    FOREIGN KEY (vehicle_id) REFERENCES VEHICLES(vehicle_id),
    FOREIGN KEY (user_id) REFERENCES USERS(user_id),
    FOREIGN KEY (parking_id) REFERENCES PARKINGS(parking_id),
    FOREIGN KEY (rate_id) REFERENCES RATES(rate_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE PARKING.PAYMENTS (
    payment_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique payment identifier",
    entry_id INT(11) NOT NULL COMMENT "FK - Related entry record",
    payment_method ENUM('cash', 'transfer') NOT NULL COMMENT "Payment method used",
    qr_code VARCHAR(255) NULL COMMENT "QR code for transfer payments",
    payment_status ENUM('pending', 'completed') NOT NULL DEFAULT 'pending' COMMENT "Payment status",
    payment_date DATETIME NULL COMMENT "Payment date and time",
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Record creation date",
    PRIMARY KEY (payment_id),
    FOREIGN KEY (entry_id) REFERENCES ENTRIES(entry_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE PARKING.INVOICES (
    invoice_id INT(11) NOT NULL AUTO_INCREMENT COMMENT "PK - Unique invoice identifier",
    payment_id INT(11) NOT NULL COMMENT "FK - Related payment",
    client_id INT(11) NOT NULL COMMENT "FK - Related client",
    details TEXT NOT NULL COMMENT "Invoice details",
    issue_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP() COMMENT "Invoice issue date",
    PRIMARY KEY (invoice_id),
    FOREIGN KEY (payment_id) REFERENCES PAYMENTS(payment_id),
    FOREIGN KEY (client_id) REFERENCES CLIENTS(client_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;